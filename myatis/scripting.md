### LanguageDriver
一个接口。一个createParameterHandler方法用于创建ParameterHandler。两个createSqlSource重载方法一个从String，另一个从XNode创建SqlSource。
### LanguageDriverRegistry
内部有个Class对应LanguageDriver实例的一个map，用于管理LanguageDriver实例，可以添加获取，配置默认LanguageDriver或获取默认LanguageDriver。

## defaults
### RawSqlSource
有两个重载的构造方法，区别在sql语句的来源，一个直接就是个字符串，另一个是个SqlNode。构造方法先有一个代表sql语句的字符串，再构造出一个SqlSourceBuilder，通过这个SqlSourceBuilder的parse方法获取SqlSource并赋值道类属性上。实现了SqlSource接口，只有一个方法getBoundSql，方法入参直接作为SQLSource的getBoundSql入参，返回BoundSql。类中还包含一个私有静态方法getSql，在语句来源为SqlNode时，通过构建DynamicContext完成动态语句的处理，返回处理后的语句。（动态处理部分存在疑问）
### RawLanguageDriver
继承自XMLLanguageDriver，不支持动态化内容。
### DefaultParameterHandler
实现了ParameterHandler接口，实现对preparedStatement的赋值。从BoundSql中获取ParameterMapping列表，迭代这个列表，对每一个ParameterMapping的propery找出对应value，从ParameterMapping获取TypeHandler和JdbcType，最后调用Typehandler的setParameter方法完成对PreparedStatement的参数赋值。

## xmltags
### DynamicContext
ContextMap 内部静态类继承自HashMap，重写了get方法，方法首先判断是否包含指定key值，若存在则调用父类get方法，反之则通过封装的Metaobject获取对应的值。
ConTextAccess 内部静态类实现了PropertyAccessor接口，把target对象转成Map进行取值和配置数值。
该类的属性有ContextMap bindings，StringBuilder sqlBuilder，一个int数字uniqueNumber。方法getBindings用于获取bindings，方法bind用于向bindings中添加值，appendSql用于sqlBuilder拼接字符串，getSql返回sqlBuilder转成的字符串，getUniqueNumber将uniqueNumber加1并返回。在构造方法中，如果入参parameterObject不为null且不为Map的实例，则会通过Configuration.newMetaObejct方法获取对应的MetaObejct对象，在创建bindings时传入，最后会把parameterObject和databaseId使用对应默认字符串为key添加到bindings中。

### SqlNode
一个接口，只有一个方法apply，入参为DynamicContext，返回值为布尔值。
### ChooseSqlNode
实现了SqlNode接口，封装了一个SqlNode列表ifSqlNode和一个SqlNode defaultSqlNode。方法apply，首先为迭代ifSqlNodes，对每个SqlNodo调用apply方法，若返回为true则方法就直接返回true。若上一步未返回且defualtSqlNode不为null，则调用defaultSqlNode的apply方法并直接返回true，否则返回false。
### ForEachSqlNode
实现了SqlNode接口，用于处理```foreach```语句。
通过ExpressoinEvaluator和ognl表达式从bindings中获取Iterable对象iterable。
调用applyOpen方法，添加open字符串。
迭代iterable，构建PrefixedContext代理原来的context，除第一次迭代外使用空字符串外，其余次数都使用separator。
调用applyIndx和applyItem将iterable的单次对象添加到context中。除了使用方法第二个入参作为key值添加外，还使用静态方法itemizeItem生成新的key再次添加一遍。
使用Configuration、context、index、item、uniqueNumber为入参构建出FilteredDynamicContext，SqlNode contents的apply方法
迭代完成后，调用applyClose添加close字符串，从context的bindings中移除item和index。

FilteredDynamicContext内部类继承自DynamicContext，使用组合模式，除了appendSql外其它方法都是直接委托给内部DynamicContext对象。重写的appendSql方法，构造出GenericTokenParser对象,调用GenericTokenParser的parse方法，将原sql中```#{content}```的context通过调用静态方法itemizeItem方法转成通用名字，最后以拼接替换后的字符串为入参委托给内部对象
PrefixedContext内部类继承自DynamicContext，使用组合模式，重写了appendSql方法，首次添加一个非空字符串时先添加一个字符串prefix，之后委托给内部对象。
### IfSqlNode
实现了SqlNode接口，apply方法内使用ExpressionEvaluator的evaluateBoolean获取ognl test下bindings的值，如果为true则调用内部属性SqlNode的apply方法并返回true，为false则直接返回false。
### MixedSqlNode
实现了SqlNode接口，封装了一个SqlNode列表contents。apply方法迭代contents，对每个SqlNode都简单的调用对应apply，最后返回true。
### TrimSqlNode
实现了SqlNode接口，方法apply首先构建内部类FilteredDynamicContext filteredDynamicContext,以为filteredDynamicContext入参调用SqlNode contents的apply方法，调用的filteredDynamicContext的applyAll方法，返回之前调用contexts的apply方法的返回值。
静态方法parseOverrides作用是将指定的字符串以'''|'''为分隔符，分割出字符串构成列表返回。
FilteredDynamicContext内部类继承自DynamicContext，使用装饰器模式。该类添加了额外的一个StringBuilder属性sqlBuffer，appendSql是向子类的sqlBuffer添加字符串，添加了一个新的公共方法applyAll。applyAll方法将sqlBuffer转成字符串剔除首尾空格又构建成StringBuilder赋值给sqlBuffer，sqlBuffer转成字符串在转成大英语大写赋值给trimmedUppercaseSql，如果trimmedUppercaseSql不为空则调用applyPrefix和applySuffix处理sqlBuffer，最后将sqlBuffer添加到delegate。方法applyPrefix中，迭代prefixesTooverride列表，判断trimmedUppercaseSql是否以迭代出的字符串开头，找到即从sqlBuffer中删除并跳出迭代，最后若prefix不为空则添加到sqlBuilder中。方法applySuffix与applyPrefix逻辑相似，只不过处理的是后缀。
### StaticTextSqlNode
实现了SqlNode接口，apply方法只是简单的将内部属性text添加到context上。
### TextSqlNode
GenericTokenParser内部类实现了TokenHandler接口， handleToken方法从context的bindings中获取参数对象parameter，如果parameter为null则以"value"为key，null为value加入bindings中，如果parameter的类型在SimpleTypeRegistry的集合中则"value"为key将parameter添加到bindings中。依据ognl表达式content从bindings中获取对应的值记为value，value转成字符串记成strValue，使用checkInjection方法检查字符串strValue符合injectionFilter这个正则表达式，检查通过则返回strValue，未通过抛出ScriptingException。
### DynamicSqlSource
封装了Configuration和SqlNode，实现SqlSource接口。在getBoundSql方法中，先构造出DynamicContext context，context作为入参调用SqlNode的apply方法，构建出SqlSourceBuilder sqlSourceParser，调用sqlSourceParser的parse方法获取SqlSource对象，以parameterObject为入参调用sqlSource的getBoundSql方法获取BoundSql boundSql对象，最后将context的bindings 所有键值对添加到boundSql中并返回boundSql。

### ExpressoinEvaluator
一个工具类，通过OgnlCache获取表达式对应的值。evaluateBoolean方法从指定对象中获取表达式对应的值，把这个值转成布尔值后返回。evaluateIteable方法从指定对象中获取表达式对应的值，把这个值转成Iterables对象并返回。
### OgnlCache
一个工具类，公共静态方法getValue，依据ognl表达式从指定对象中获取对应的值。类的内部保存了ognl表达式字符串及对应解析完成的表达式对象。

### XMLScriptBuilder
    继承自BaseBuilder，封装XNode、一个布尔值isDynamic、类型parameterType、一个string对NodeHandler的nodeHandlerMap。
    构造方法中调用了initNodeHandlerMap完成了对nodeHandlerMap的包括trim、where、set、foreach、if、choose、when、otherwise、bind等NodeHandler的添加。NodeHandler是一个内部私有接口，这些实现了mapper.xml中sql动态的语句处理。
