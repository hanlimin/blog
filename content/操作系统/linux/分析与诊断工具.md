## Linux下分析工具

![](https://i.loli.net/2020/08/27/WcFrQV8GBLsTYkR.png)

### 

### uptime

获取系统基本信息，包含运行时长、当前时间、登陆用户数量、负载信息

### mpstat

实时CPU统计，-P 指定CPU，也可指定间隔时间和采样次数

### top

查看系统运行性能数据和系统进程信息

#### 显示信息字段含义

- top：当前时间、登录用户数量，负载
- Tasks：总进程数，运行进程数，睡眠进程数，停止进程数，僵死进程数
- %Cpu：用户空间比率，内核空间比率，用户空间低优先度进程比率，空闲时间比率，等待时间比率，硬件中断比率，软件中断比率，虚拟CPU比率
- Mem：总内存，空闲内存，使用中内存，内核缓存内存
- Swap：总内存，空闲内存，使用中内存，可用内存

#### 命令

- b 打开运行状态进程高亮
- x 打开排序和高亮指定列
- S_<、S\_> 左右切换指定列
- f 进入显示信息列选择菜单
- k 终止进程
- i 忽略空闲和僵死进程
- s 设置刷新时间
- m 内存信息
- t CPU信息 
- M 根据内存占比排序
- T 根据时间排序

### ps

#### 常用选项

- a BSD-style，显示当前终端下所有进程
- x BSD-style，不在当前终端下的进程也会展示
- axjf 树形结构显示进程
- e 显示所有进程
- o 指定要显示的信息，args, cmd, comm, command, fname, ucmd, ucomm, lstart, bsdstart 和 start
- f 更多信息
- u 指定用户
- C 指定进程名字
- L 展示指定进程编号下的所有线程

### free

获取内存信息

### dmesg

获取系统开机信息



### vmstat

查看系统运行性能数据

#### 信息字段

- r 运行进程数量

- b 阻塞进程数量

- swpd 虚拟内存大小

- free 空闲内存大小

- buff 缓冲大小

- cache 缓存大小

- si 交换空间读入大小

- so 交换空间写出大小

- bi 从块设备接收块数量

- bo 发送到块设备的块数量

- in CPU每秒中断次数

- cs  每秒上下文切换次数

- us 用户CPU时间

- sy 系统CPU时间

- id  空闲CPU时间

- wa 等待时间

- st 虚拟CPU使用占比

### lsof

Linux下万物皆文件，

#### 信息字段

- COMMAND 进程名称
- PID 进程标识符
- USER 进程拥有者
- FD 文件描述符
- TYPE 文件类型
- DEVICE 磁盘名称
- SIZE 文件大小
- NODE 索引节点
- NAME 打开文件的名称

#### 常用选项

- -u 指定用户
- -c 指定进程
- -p 指定进程标识符
- -i  列出所有网络连接
- +d 查询指定目录下被进程打开的文件
- +D 递归所有目录下被打开的文件
- -d 指定FD 文件描述符
- -n 直接显示ip而不是hostname

### tcpdump

linux下的抓包工具，功能强劲，也可以导出文件，再使用wireshark软件更加便于分析

#### 常用选项

- -c 指定抓包数量
- -n 地址以数字方式显示
- -nn 端口号以数字方式显示
- -P 指定抓取流入还是流出的包，可给定值in、out、inout
- -s 设定抓取包的数据长度
- -e 输出MAC
- -q 快速打印，简略输出信息
- -X 输出头部信息
- -XX 更详尽的头部信息
- -v 输出详细信息
- -vv
- -vvv
- -t 不打印时间戳
- -tt 打印时间戳
- -ttt 打印相对时间
- -w 保存到文件，文件可使用wireshark分析

#### 过滤表达式

- type 指定host、net、port、portrange
- dir 指定数据流方向
- proto 指定协议
- 可以使用逻辑运算符 and、or、not

### netstat

TCP/IP网络监控工具

#### 常用选项

- a 显示所有连接
- t 显示tcp连接
- u 显示upd连接
- n 显示数字地址
- l 显示正在监听地址
- p 显示进程信息
- e 显示所属用户标识符
- r 显示内核路由信息
- i 显示网络接口设备统计信息
- s 显示针对不同网络协议的统计信息

### iotop

显示信息格式与top相似，显示每个进程读写宽带和swap和等待IO所占用百分比

#### 菜单

- 左右箭头，改变排序方式
- r，改变排序顺序
- o，只显示有IO输出的进程
- p  进程/线程的显示方式切换
- a 显示累计使用量

### iostat

查询IO统计信息，关键参数%util、await、avgqu-sz。

#### 显示字段

- tps：每秒的传输次数
- kB_read/s	每秒从设备读取的数据量
- kB_wrtn/s	每秒向设备写入的数据量
- kB_read	读取的总数据量
- kB_wrtn	写入的总数据量
- rrqm/s: 每秒进行 merge 的读操作数目。即 rmerge/s 
- wrqm/s: 每秒进行 merge 的写操作数目。即 wmerge/s
- r/s: 每秒完成的读 I/O 设备次数。即 rio/s
- w/s: 每秒完成的写 I/O 设备次数。即 wio/s
- rsec/s: 每秒读扇区数。即 rsect/s
- wsec/s: 每秒写扇区数。即 wsect/s
- rkB/s: 每秒读K字节数。是 rsect/s 的一半，因为每扇区大小为512字节。
- wkB/s: 每秒写K字节数。是 wsect/s 的一半。
- avgrq-sz: 平均每次设备I/O操作的数据大小 (扇区)。
- avgqu-sz: 平均I/O队列长度。
- await: 平均每次设备I/O操作的等待时间 (毫秒)。
- svctm: 平均每次设备I/O操作的服务时间 (毫秒)。
- %util: 一秒中有百分之多少的时间用于 I/O 操作，即被io消耗的cpu百分比

#### 常用选项

- `-C` 显示CPU使用情况
- `-d` 显示磁盘使用情况
- `-k` 以 KB 为单位显示
- `-m` 以 M 为单位显示
- `-N` 显示磁盘阵列(LVM) 信息
- `-n` 显示NFS 使用情况
- `-p`[磁盘] 显示磁盘和分区的情况
- `-t` 显示终端和CPU的信息
- `-x` 显示详细信息
- `-V` 显示版本信息
- 可指定时间选项，第一数字可指定获取统计时间间隔，第二数字可规定获取数据次数

### sar

#### 常用选项

- -A：所有报告的总和。
- -u：CPU利用率
- -v：进程、I节点、文件和锁表状态。
- -d：硬盘使用报告。
- -r：没有使用的内存页面和硬盘块。
- -g：串口I/O的情况。
- -b：缓冲区使用情况。
- -a：文件读写情况。
- -c：系统调用情况。
- -R：进程的活动情况。
- -y：终端设备活动情况。
- -w：系统交换活动。
- -n: 记录网络使用情况
- -s:  指定开始时间
- -e： 指定结束时间
- -o：输出查询出的统计信息到指定文件
- -f：输出保存到文件中的统计信息

#### 显示字段

##### cpu信息

- %user：显示在用户级别(application)运行使用 CPU 总时间的百分比

- %nice：显示在用户级别，用于nice操作，所占用 CPU 总时间的百分比

- %system：在核心级别(kernel)运行所使用 CPU 总时间的百分比

- %iowait：显示用于等待I/O操作占用 CPU 总时间的百分比

- %steal：管理程序(hypervisor)为另一个虚拟进程提供服务而等待虚拟 CPU 的百分比

- %idle：显示 CPU 空闲时间占用 CPU 总时间的百分比

##### 文件节点信息

- dentunusd：目录高速缓存中未被使用的条目数量

- file-nr：文件句柄（file handle）的使用数量

- inode-nr：索引节点句柄（inode handle）的使用数量

- pty-nr：使用的 pty 数量

##### 内存利用率

- kbmemfree：这个值和 free 命令中的 free 值基本一致，所以它不包括 buffer 和 cache 的空间

- kbmemused：这个值和 free 命令中的 used 值基本一致,所以它包括 buffer 和 cache 的空间

- %memused：这个值是 kbmemused 和内存总量(不包括 swap)的一个百分比

- kbbuffers 和 kbcached：这两个值就是 free 命令中的 buffer 和 cache

- kbcommit：保证当前系统所需要的内存，即为了确保不溢出而需要的内存(RAM + swap)

- %commit：这个值是 kbcommit 与内存总量(包括 swap)的一个百分比

##### 内存分页状况

- pgpgin/s：表示每秒从磁盘或SWAP置换到内存的字节数(KB)

- pgpgout/s：表示每秒从内存置换到磁盘或SWAP的字节数(KB)

- fault/s：每秒钟系统产生的缺页数，即主缺页与次缺页之和(major + minor)

- majflt/s：每秒钟产生的主缺页数

- pgfree/s：每秒被放入空闲队列中的页个数

- pgscank/s：每秒被 kswapd 扫描的页个数

- pgscand/s：每秒直接被扫描的页个数

- pgsteal/s：每秒钟从 cache 中被清除来满足内存需要的页个数

- %vmeff：每秒清除的页(pgsteal)占总扫描页(pgscank + pgscand)的百分比

##### IO信息

- tps：每秒钟物理设备的 I/O 传输总量

- rtps：每秒钟从物理设备读入的数据总量

- wtps：每秒钟向物理设备写入的数据总量

- bread/s：每秒钟从物理设备读入的数据量，单位为：块/s

- bwrtn/s：每秒钟向物理设备写入的数据量，单位为：块/s

##### 队列长度和平均负载

- runq-sz：运行队列的长度（等待运行的进程数）

- plist-sz：进程列表中进程（processes）和线程（threads）的数量

- ldavg-1：最后1分钟的系统平均负载（System load average）

- ldavg-5：过去5分钟的系统平均负载

- ldavg-15：过去15分钟的系统平均负载

##### 系统交换信息

- pswpin/s：每秒系统换入的交换页面（swap page）数量
- pswpout/s：每秒系统换出的交换页面（swap page）数量

##### 块设备状况

- tps: 每秒从物理磁盘 I/O 的次数。多个逻辑请求会被合并为一个 I/O 磁盘请求，一次传输的大小是不确定的

- rd_sec/s: 每秒读扇区的次数

- wr_sec/s: 每秒写扇区的次数

- avgrq-sz: 平均每次设备 I/O 操作的数据大小(扇区)

- avgqu-sz: 磁盘请求队列的平均长度

- await: 从请求磁盘操作到系统完成处理，每次请求的平均消耗时间，包括请求队列等待时间，单位是毫秒(1秒=1000毫秒)

- svctm: 系统处理每次请求的平均时间,不包括在请求队列中消耗的时间.

- %util: I/O请求占CPU的百分比，比率越大，说明越饱和

### pmap

获取指定进程的内存映射信息

#### 常用选项

- -x：显示扩展格式
- -d：显示设备格式
- -q：不显示头尾行

#### 信息字段

- Address: 内存开始地址
- Kbytes: 占用内存的字节数（KB）
- RSS: 保留内存的字节数（KB）
- Dirty: 脏页的字节数（包括共享和私有的）（KB）
- Mode: 内存的权限：read、write、execute、shared、private (写时复制)
- Mapping: 占用内存的文件、或[anon]（分配的内存）、或[stack]（堆栈）
- Offset: 文件偏移
- Device: 设备名 

### ulimit

- -a：显示目前资源限制的设定
- -c <core文件上限>：设定core文件的最大值，单位为区块
- -d <数据节区大小>：程序数据节区的最大值，单位为KB
- -f <文件大小>：shell所能建立的最大文件，单位为区块
- -H：设定资源的硬性限制，也就是管理员所设下的限制
- -m <内存大小>：指定可使用内存的上限，单位为KB
- -n <文件数目>：指定同一时间最多可开启的文件数
- -p <缓冲区大小>：指定管道缓冲区的大小，单位512字节
- -s <堆叠大小>：指定堆叠的上限，单位为KB
- -S：设定资源的弹性限制
- -t <CPU时间>：指定CPU使用时间的上限，单位为秒
- -u <程序数目>：用户最多可开启的程序数目
- -v <虚拟内存大小>：指定可使用的虚拟内存上限，单位为KB



### pidstat

系统性能统计工具

#### 常用选项

- -u 默认的参数，显示各个进程的CPU使用统计
- -r 显示各个进程的内存使用统计
- -d 显示各个进程的IO使用情况
- -p 指定进程号
- -w 显示每个进程的上下文切换情况
- -t 显示选择任务的线程的统计信息外的额外信息

### ss

与netstat相似

### slabtop

查询内核slab缓存统计信息

### perf

每隔一个固定时间在CPU产生一个中断，记录此中断时CPU上的运行信息，比如pid、函数等信息。

#### 子命令

- top 类似系统命令 查看消耗cpu比较高的内核函数或者进程

- list 列出perf支持的事件

- stat 统计profiling进程的各种信息

- record profiling进程的数据，并生成 xx.data文件

- report 读取xx.data文件

### gperftools

### ftrace

### starce

跟踪进程执行时的系统调用和所接受的信号