---
title: 相似判断
date: "2021-02-19 15:26:40"
modifyDate: "2021-02-19 15:26:40"
draft: true
---
图像相等的严格判别法
比较两个图片是否相等，有很多方法，最直观的，也最容易想到的算法就是遍历两个图片的每一个像素，最终求差来得到两个图片是否相等。

直方图比较法
直方图比较法是一个比较基础，也比较简单快捷的一种办法，目前我就是使用这个方法作为项目的主力相似性判别法。

直方图比较的原理是，将所要比较的两幅图片的直方图数据，然后再将直方图数据归一化之后方便比较，最终得到一个相似指数，通过设定相似指数的边界，我们可以得到是否是同一张图片。

感知哈希算法
感知哈希算法（pHash，全拼：Perceptual hash algorithm）是哈希算法的一种，哈希算法还包括平均值哈希算法（aHash），差异值哈希算法（dHash），经过对比之后，最终决定采用pHash算法来作为辅助相似性判别法。

pHash简单来说，是通过感知哈希算法对每张图片生成一个“指纹”字符串，然后通过比较“指纹”字符串的距离（通常采用汉明距离，Hamming distance，两个等长字符串之间的汉明距离，是两个字符串对应位置的不同字符的个数），这个距离越小，代表两个图片越相似，一般的，我们有下面规则：

 Hamming distance = 0  -> particular like
 Hamming distance < 5  -> very like
 hamming distance > 10 -> different picture
关于aHash, pHash, dHash的区别，我总结如下：

aHash：平均值哈希。转灰度压缩之后计算均值，最终通过像素比较得出哈希值，速度很快，但敏感度很高，稍有变化就会极大影响判定结果，精准度较差。因此比较适用于缩略图比较，最常用的就是以图搜图。
pHash：感知哈希。在均值哈希基础上加入DCT（离散余弦变化，下面也会涉及，这里不展开），两次DCT就可以很好的将图像按照频度分开，取左上角高能低频信息做均值哈希，因此，精确度很高，但是速度方面较差一些。
Opencv实测速度比平均哈希慢大概200ms～700ms左右（我自己的开发机，不同机器，不同版本可能结果也会不同）。相比较aHash，pHash更加适合用于缩略图比较，也非常适合比较两个近似图片是否相等。
比如你所要比较的两张图片就只有一个button有变化，其余的都没有变化，采用严格的aHash很有可能就得到错误的结果，这种情况就可以放心大胆的采用pHash算法进行比较。实际上，这个场景就是我们项目中实际碰到的，最终也是通过pHash来解决的。
dHash：差异值哈希。转灰度压缩之后，比较相邻像素之间差异。
假设有10×10的图像，每行10个像素，就会产生9个差异值，一共10行，就一共有9×10=90个差异值。最终生成哈希值即指纹。
速度上来说，介于aHash和pHash之间，精准度同样也介于aHash和pHash之间。所以前两种哈希的适用场景，dHash也完全适用，如果你想要一个精准度较高而且速度比较快的算法，那就选择dHash吧
