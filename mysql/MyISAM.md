## MyISAM

### 缓冲配置

#### MyISAM键缓存（Key Caches）

MyISAM自身只缓存索引，不缓存数据。可以使用`CACHE INDEX`命令来将表映射到对应的缓冲区。可以使用`LOAD INDEX`命令预缓存指定表的索引。MyISAM使用操作系统缓存来缓存数据文件，通常数据文件较索引要大，所以把更多的内存保留给操作系统缓存而不是键缓存是有意义的。最后，即使没有任何MyISAM表，依然需要将key_buffer_size设置为较小的值，因为MySQL服务器有时会在内部使用MyISAM表，例如GROUP BY语句可能会使用MyISAM做临时表。

- `key_buffer_size`，设置大小不超过索引总大小或操作系统缓存保留内存的25%~50%，以更小的为准。可以创建多个命名的键缓冲。

### I/O配置

#### 键缓冲刷新

MyISAM通常每次写操作之后就把索引变更刷新到磁盘。如果在一张表上做很多修改，批量操作会更快一点。一种办法时`LOCK TABLES`延迟写入，直到解锁这些表。通过配置`delay_key_wirte`变量，也可以延迟索引写入，修改的键缓冲块直到表被关闭才会刷新。

- `OFF` 每次写操作刷新键缓冲。
- `ON` 打开延迟键写入，但是只对用`DELAY_KEY_WRITE`选项创建的表有效。
- `ALL` 所有的MyISAM表都会使用延迟键写入。

#### 表损坏恢复

`myisam_recover`选项控制MyISAM怎么寻找和修复错误。

- `DEFAULT` 默认值，在恢复时不执行其它动作
- `BACKUP` 让MySQL将数据文件的备份写道`.BAK`文件，以便随后进行检查。
- `FORCE` 即使`.MYD`文件中丢失的数据可能超出一行，也让恢复继续。
- `QUICK` 除非有删除块，否则跳过恢复。

### 并发配置

MyISAM删除操作不用重新整理整个表，只是把行标记为删除，在表中留下空洞。MyISAM倾向于在可能的时候填满这些空洞，在插入时重新利用这些空洞，如果没有空洞了才会把新行插入表的末尾。尽管MyISAM是表级锁，它依然可以一边读取，一边并发追加新行。然而，若表中间的某些数据变动了话，还是很难提供一致读。所以除非插入操作在表的末尾，否则不支持并发插入。可以通过设置`concurrent_insert`这个变量来控制MyISAM的并发插入

- 0 不允许并发插入，所有插入都会对表加互斥锁。
- 1 默认值。只要表中没有空洞，就允许并发插入。
- 2 MySQL 5.0以及更新版本中有效。它强制并发插入到表的末尾，即使表中有空洞。如果没有线程从表中读取数据，MySQL将把新行放在空洞中。