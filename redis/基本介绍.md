### 特性

- 速度快
    - 所有数据均在内存中
    - C语言实现
    - 单线程架构，避免了多线程可能产生的竞争问题
    - 源码优秀
- 基于键值对的数据结构
    - 字符串
    - 哈希
    - 列表
    - 集合
    - 有序集合
- 丰富功能
    - 键过期
    - 发布订阅
    - 支持Lua脚本
    - 提供简单事务
    - 提供Pipeline功能
- 简单稳定
- 客户端语言多
- 持久化
- 主从复制
- 高可用

### 使用场景

1. 缓存
2. 排行榜系统
3. 计数器应用
4. 社交网络
5. 消息队列

### 可执行文件

| 可执行文件       | 作用                              |
| ---------------- | --------------------------------- |
| redis-server     | 启动Redis                         |
| redis-cli        | Redis命令行客户端                 |
| redis-benchmark  | Redis基准测试工具                 |
| redis-check-aof  | Redis AOF持久化文件检测和修复工具 |
| redis-check-dump | Redis RDB持久化文件检测和修复工具 |
| redis-sentinel   | 启动Redis Sentinel                |

#### redis-server

- --test-momory

    可用来检测当前操作系统能稳定地分配指定容量的内存给Redis。

#### redis-cli

- -r

    -r(repeat)选项代表将命令执行多次。

- -i

    -i(interval)选项代表每隔几秒执行一次命令。

- -x

    -x选项代表从标准输入（stdin）读取数据作为redis-cli的最后一个参数。

- -c

    -c(cluster)选项是连接Redis Cluster节点时需要使用的。

- -a

    如果Redis配置了密码，可以使用\- a 选项（auth）选项。

- --scan和--pattern

    --scan和--pattern选项用于扫描指定模式的键。

- --slave

    --slave选项时把当前客户端模拟成当前Redis节点的从节点，可用用来获取当前Redis节点的更新操作。

- --rdb

    --rdb选项会请求Redis实例生成并发送RDB持久化文件，保存到本地。

- --bigkeys

    --bigkeys选项使用scan命令对Redis的键进行采用，从中找出内存占用比较大的键值，这些键值可能是系统的瓶颈。

- --eval

    --eval选项用于执行指定Lua脚本。

- --latency

    latency有三个选项，分别是--latency、--latency-history、--latency-dist。它们都可以检测网络延迟，对于Reids的开发和运维非常有帮助。

- --stat

    --stat选项可以实时获取Redis的重要统计信息。

- --raw和--no-raw

    --no-raw信息是要求命令的返回格式必须是原始的格式，--raw恰恰相反，返回格式化后的结果。

### redis-benchmark

- -c 

    -c（clients）选项代表客户端的并发数量（默认为50）。

- -n [ requesnts]

    -n（num）选项代表客户端请求总数（默认是100000）。

- -q

    -q选项仅仅显示redis-benchmark的request per second信息。

- -r num

    -r（random）选项向Redis插入更多随机的键。num代表插入的数量。

- -P

    -P选项代表每个请求pipline的数据量（默认为1）.

- -k <boolean>

    -k选项代表客户端是否使用keepalive，1为使用，0为不适用，默认值为1。

- -t 

    -t选项可以对指定命令进行基准测试。

- --csv

    --csv选项会将结果按照csv格式输出。

### 启动

有三中方式启动Redis：默认配置、运行配置、配置文件启动。默认端口为6379.

```ini
# 端口
port 
# 日志文件
logfile
# 工作目录
dir
# 是否以守护进程启动
daemonize
```

### 客户端通信协议

客户端和服务端的通信协议是在TCP协议之上构建的。Redis指定了RESP（Redis serialization Protocal，Redis序列化协议）实现了客户端和服务端的正常交互，这种协议简单高效，即能够被机器解析，有容易被人类识别。

#### 发送命令格式

```
*<参数个数>CRLF
$<参数1的字节数量>CRLF
<参数1>CRLF
...
$<参数N的字节数量>CRLF
<参数N>CRLF
```

#### 返回结果格式

Redis的返回结果类型分为一下五种：

状态回复：在RESP中第一个字节为“+”。

错误回复：在RESP中第一个字节为“-”。

整数回复：在RESP中第一个字节为“:”。

字符串回复：在RESP中第一个字节为“$”。

多条字符串回复：在RESP中第一个字节为“*”。

### 重要版本演变

#### Redis 2.6

- 服务端支持Lua脚本
- 去掉虚拟内存相关功能
- 放开对客户端连接数的硬编码限制
- 键的过期时间支持毫秒
- 从节点提供只读功能
- 两个新的位图命令：bitcount和bitop
- 增强了redis-benchmark的功能：支持定制化的压测、CSV输出功能
- 基于浮点数的自增命令：incrbyfloat和hincrbyfloat
- redis-cli可以使用`--eval`参数实现Lua脚本执行
- shutdown命令增强
- info可以按照section输出，并且添加了一些统计项
- 重构了大量核心代码，所有集群相关的代码都去掉了，cluster功能将会是3.0的最大亮点
- sort命令优化

#### Redis 2.8

- 添加部分主从复制功能，在一定程度上降低了由于网络问题，造成频繁全量复制生成RDB对系统造成的压力
- 尝试性支持IPv6
- 可以通过config set命令设置maxclients
- 可以通过bind命令绑定多个IP地址
- Redis设置了明显的进程名字，方便使用ps命令查看系统进程
- config rewrite命令可以将config set持久化到Redis配置文件中
- 发布订阅添加了pubsub命令
- Redis Sentinel第二版，相比于Redis 2.6的Redis Sentinel，此版本已经变成生产可用

#### Redis 3.0

- Redis Cluster，Redis的官方分布式实现
- 全新deembedded string对象编码结果，优化小对象内存访问，在特定的工作负载下速度大幅度提升
- lru算法大幅度提升
- migrate连接缓存，大幅度提升迁移速度
- migrate命令两个新的参数：copy和replace
- 新的client pause命令，在指定时间内停止处理客户端请求
- bitcount命令性能提升
- config set设置maxmemory的时候可以设定不同的单位
- Redis日志调整：日志中会反应当前实例的角色
- incr命令性能提升

#### Redis 3.2

- 添加GEO相关功能
- SDS在速度和空间上都做了优化
- 支持用upstart或者systemd管理Redis进程。
- 新的List编码类型：quicklist
- 从节点读取过期数据保证一致性
- 添加了hstrlen命令
- 增强了debug命令，支持了更多的参数
- Lua脚本功能增强
- 添加了Lua Debugger
- config set支持更多的参数
- 优化了Redis崩溃后的相关报告
- 新的RDB格式，但是仍兼容旧的RDB
- 加速RDB的加载速度
- spop命令支持个数参数
- cluster nodes命令得到加速
- Jemalloc更新到4.0.3版本

#### Redis 4.0

- 提供了模块系统，方便第三方开发者拓展Redis的功能
- PSYNC 2.0：优化了之前版本中，主从节点切换必然引起的全量复制的问题
- 提供了新的缓存提出算法：LFU(Last Frequently Used)，并对已有算法进行了优化
- 提供了非阻塞del和flushall/flushd功能，有效解决删除bigkey可能造成的Redis阻塞
- 提供了RDB-AOF混合持久化格式，充分利用了AOF和RDB各自优势
- 提供memory命令，实现了对内存更为全面的监控统计
- 提供了交互数据库功能，实现Redis内存数据库之间的数据置换
- Redis Cluster兼容NAT和Docker
- 惰性释放，能够在后台其它线程中删除KEY

#### Redis 5.0

- 新的流数据类型(Stream data type)

- 新的 Redis 模块 API：定时器、集群和字典 API(Timers, Cluster and Dictionary APIs)

- RDB 现在可存储 LFU 和 LRU 信息

- redis-cli 中的集群管理器从 Ruby (redis-trib.rb) 移植到了 C 语言代码。

- 新的有序集合命令：ZPOPMIN/MAX 和阻塞变体(blocking variants)

- 升级 Active defragmentation 至 v2 版本

- 增强 HyperLogLog 的实现

- 更好的内存统计报告

- 许多包含子命令的命令现在都有一个 HELP 子命令

- 客户端频繁连接和断开连接时，性能表现更好

- 许多BUG修复和其他方面的改进

- 升级 Jemalloc 至 5.1 版本

- 引入 CLIENT UNBLOCK 和 CLIENT ID

- 新增 LOLWUT 命令

- 在不存在需要保持向后兼容性的地方，弃用 "slave" 术语
- Lua 相关的改进：
    - 将 Lua 脚本更好地传播到 replicas / AOF
    - Lua 脚本现在可以超时并在副本中进入 -BUSY 状态

- 网络层中的差异优化
- 引入动态的 HZ以平衡空闲 CPU 使用率和响应性
- 对 Redis 核心代码进行了重构并在许多方面进行了改进

